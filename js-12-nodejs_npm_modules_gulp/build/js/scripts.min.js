"use strict";var refs={form:document.querySelector("form"),userUrlField:document.querySelector("#url"),addButton:document.querySelector("button"),result:document.querySelector(".result"),template:Handlebars.compile(document.querySelector("#cards").innerHTML.trim())};refs.addButton.addEventListener("click",getInfo),document.addEventListener("DOMContentLoaded",showItems),refs.result.addEventListener("click",handleRemoveCard);var API_KEY="5baa8080bf727afb735190e7841c374bda633412561ba",API_URL="http://api.linkpreview.net/";function getInfo(e){e.preventDefault();var t=refs.userUrlField.value;checkValid(t)?fetch(API_URL+"?key="+API_KEY+"&q="+t).then(function(e){if(e.ok)return e.json();throw new Error("Error when fetching data: "+e.statusText)}).then(function(e){return handleAddCard(e)}).catch(function(e){return console.log("Site not found! "+e)}):alert("You have entered a wrong url!")}function checkValid(e){return/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi.test(e)}function checkPresent(t){var e=(JSON.parse(localStorage.getItem("sitesArray"))||[]).filter(function(e){return e.url===t});return console.log(e),0<e.length}function handleAddCard(e){checkPresent(e.url)?alert("This url is present in your store!"):(addToView(e),addtoLocalStorage(e),refs.form.reset())}function addToView(e){var t=refs.template(e);refs.result.insertAdjacentHTML("afterbegin",t)}function addtoLocalStorage(e){var t=JSON.parse(localStorage.getItem("sitesArray"))||[];t.unshift(e),localStorage.setItem("sitesArray",JSON.stringify(t))}function handleRemoveCard(e){var t=e.target;if("BUTTON"===t.tagName&&t.classList.contains("remove")){var r=t.closest(".card"),n=r.querySelector(".url-id").textContent;removeFromView(r),removeFromLocalStorage(n)}}function removeFromView(e){e.remove()}function removeFromLocalStorage(t){var e=JSON.parse(localStorage.getItem("sitesArray"))||[],r=e.filter(function(e){return e.url===t})[0];e.splice(e.indexOf(r),1),localStorage.setItem("sitesArray",JSON.stringify(e))}function showItems(e){e.preventDefault(),(JSON.parse(localStorage.getItem("sitesArray"))||[]).map(function(e){return refs.template(e)}).map(function(e){return refs.result.insertAdjacentHTML("beforeend",e)})}