!function(e){var t={};function s(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(o,r,function(t){return e[t]}.bind(null,r));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);new class{constructor(e,t){this._model=e,this._view=t,this._view.refs.addButton.addEventListener("click",this._model.getInfo.bind(this)),document.addEventListener("DOMContentLoaded",this.show.bind(this)),this._view.refs.result.addEventListener("click",this._view.handleRemoveCard.bind(this)),this.init()}init(){return this._sitesArr=JSON.parse(localStorage.getItem("sitesArray"))||[],console.log(this),console.log(this._sitesArr),this}show(){this._view.showItems.call(this)}}(new class{updLS(){console.log("starting LS update"),console.log(this._sitesArr),localStorage.setItem("sitesArray",JSON.stringify(this._sitesArr))}addToLocalStorage(e){console.log("start"),console.log("this._sitesArr: ",this._sitesArr),console.log("obj : ",e),this._sitesArr.unshift(e),console.log(this._sitesArr),this._model.updLS.call(this),console.log(this),this._view.showItems.call(this),this._view.refs.form.reset()}removeFromLocalStorage(e){console.log(this);const t=this._sitesArr.find(t=>t.url===e);this._sitesArr.splice(this._sitesArr.indexOf(t),1),console.log(this._sitesArr),this._model.updLS.call(this),this._view.showItems.call(this)}checkPresent(e){const t=this._sitesArr.filter(t=>t.url===e);return console.log(this._sitesArr),console.log(t),t.length>0}getInfo(e){e.preventDefault();const t=this._view.refs.userUrlField.value;console.log(t),console.log(this),console.log(this._view.checkValid(t)),this._view.checkValid(t)?fetch(`http://api.linkpreview.net/?key=5baa8080bf727afb735190e7841c374bda633412561ba&q=${t}`).then(e=>{if(e.ok)return e.json();throw new Error(`Error when fetching data: ${e.statusText}`)}).then(e=>{if(console.log(e),this._model.checkPresent.call(this,e.url))throw alert("This url is present in your storage!"),new Error("This url is present in your storage!");return e}).then(e=>{console.log(this),console.log(e),console.log("calling addtolocalstorage"),this._model.addToLocalStorage.call(this,e)}).catch(e=>console.log("Site not found! "+e)):alert("You have entered a wrong url!")}},new class{constructor(){this.refs={},this.refs.form=document.querySelector("form"),this.refs.userUrlField=document.querySelector("#url"),this.refs.addButton=document.querySelector("button"),this.refs.result=document.querySelector(".result"),this.refs.template=Handlebars.compile(document.querySelector("#cards").innerHTML.trim())}checkValid(e){return/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi.test(e)}handleRemoveCard(e){const t=e.target;if("BUTTON"!==t.tagName||!t.classList.contains("remove"))return;const s=t.closest(".card");console.log(t),console.log(s),console.log(this);const o=s.querySelector(".url-id").textContent;console.log(o),this._model.removeFromLocalStorage.call(this,o)}showItems(){console.log(this._sitesArr);const e=this._sitesArr.map(e=>this._view.refs.template(e));console.log(e),this._view.refs.result.innerHTML=e}})}]);